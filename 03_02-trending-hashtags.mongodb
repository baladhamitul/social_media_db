use("social_media_demo");

const since = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);

db.posts
  .aggregate([
    { $match: { createdAt: { $gte: since }, visibility: "public" } },
    { $unwind: "$hashtags" },
    {
      $group: {
        _id: "$hashtags",
        count: { $sum: 1 },
        lastUsedAt: { $max: "$createdAt" },
      },
    },
    { $sort: { count: -1, lastUsedAt: -1 } },
    { $limit: 20 },
  ]);
